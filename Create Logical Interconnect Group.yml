- name: Include all variable files
  include_vars:
    dir: 'vars' #change directory if needed
    extensions:
        - yml
#
# Gather uri's for the following networks and save as a local uri
#
- name: Gather facts about SAN A Fibre Channel Network
  oneview_fc_network_facts:
    config: "{{ config }}"
    name: "{{ NET_SAN_A }}"

- set_fact: NET_SAN_A_Uri="{{ fc_networks[0].uri }}"

- name: Gather facts about SAN B Fibre Channel Network
  oneview_fc_network_facts:
    config: "{{ config }}"
    name: "{{ NET_SAN_B }}"

- set_fact: NET_SAN_B_Uri="{{ fc_networks[0].uri }}"

- name: Gather facts about Deploy Network
  oneview_ethernet_network_facts:
    config: "{{ config }}"
    name: "{{ Deploy_NET }}"

- set_fact: NET_Deploy_Uri="{{ ethernet_networks[0].uri }}"

- name: Gather facts about VLAN DMZ Network
  oneview_ethernet_network_facts:
    config: "{{ config }}"
    name: "{{ DMZ_VLAN }}"

- set_fact: NET_VLANDMZ_Uri="{{ ethernet_networks[0].uri }}"

- name: Gather facts about VLAN Management Network
  oneview_ethernet_network_facts:
    config: "{{ config }}"
    name: "{{ Man_VLAN }}"

- set_fact: NET_VLANMan_Uri="{{ ethernet_networks[0].uri }}"

- name: Gather facts about VLAN Customer Network
  oneview_ethernet_network_facts:
    config: "{{ config }}"
    name: "{{ Cust_VLAN }}"

- set_fact: NET_VLANCust_Uri="{{ ethernet_networks[0].uri }}"
#
# Produce LIGS
#
- name: Ensure that the Logical Interconnect Group is present
  oneview_logical_interconnect_group:
    config: "{{ config }}"
    state: present
    data:
      name: 'Test Logical Interconnect Group'
      enclosureIndexes: [1]
      enclosureType: "{{ Encl_Type }}"
      interconnectBaySet: 3
      redundancyType: "Redundant"
#
# Now for the interconnect connections
#
      interconnectMapTemplate:
        interconnectMapEntryTemplates:
          - logicalDownlinkUri: ~
            logicalLocation:
                locationEntries:
                    - relativeValue: 3
                      type: "Bay"
                    - relativeValue: 1
                      type: "Enclosure"
            permittedInterconnectTypeName: "{{ InterconType40 }}"
          - logicalDownlinkUri: ~
            logicalLocation:
                locationEntries:
                    - relativeValue: 6
                      type: "Bay"
                    - relativeValue: 1
                      type: "Enclosure"
            permittedInterconnectTypeName: "{{ InterconType40 }}"
#
# This is the Uplink Set code. Everytime logical Port Config Infos appears, its a new uplink. For visual aid, a single '#' will be used to break up the code
#
      uplinkSets:
        - logicalPortConfigInfos:
          - desiredSpeed: "Auto"
            logicalLocation:
                  locationEntries:
                    - relativeValue: 6
                      type: "Bay"
                    - relativeValue: "{{ Port_Q1:1 }}"
                      type: "Port"
                    - relativeValue: 1
                      type: "Enclosure"
          - desiredSpeed: "Auto"
            logicalLocation:
                  locationEntries:
                    - relativeValue: 6
                      type: "Bay"
                    - relativeValue: "{{ Port_Q2:1 }}"
                      type: "Port"
                    - relativeValue: 1
                      type: "Enclosure"
          name: "SAN-B-UplinkSet"
          mode: "Auto"
          networkType: "FibreChannel" #Ethernet is the other option
          networkUris:
            - "{{ NET_SAN_B_Uri }}"
#
        - logicalPortConfigInfos:
          - desiredSpeed: "Auto"
            logicalLocation:
                  locationEntries:
                    - relativeValue: 3
                      type: "Bay"
                    - relativeValue: "{{ Port_Q2:1 }}"
                      type: "Port"
                    - relativeValue: 1
                      type: "Enclosure"
          - desiredSpeed: "Auto"
            logicalLocation:
                  locationEntries:
                    - relativeValue: 3
                      type: "Bay"
                    - relativeValue: "{{ Port_Q1:1 }}"
                      type: "Port"
                    - relativeValue: 1
                      type: "Enclosure"
          name: "SAN-A-UplinkSet"
          mode: "Auto"
          networkType: "FibreChannel" #Ethernet / FibreChannel are the options
          networkUris:
            - "{{ NET_SAN_A_Uri }}"
#
        - logicalPortConfigInfos:
          - desiredSpeed: "Auto"
            logicalLocation:
                  locationEntries:
                    - relativeValue: 3
                      type: "Bay"
                    - relativeValue: "{{ Port_Eth_FCoE_Q1:1 }}" #Ethernet + FCoE Capability
                      type: "Port"
                    - relativeValue: 1
                      type: "Enclosure"
          name: "Deployment-Uplink"
          mode: "Auto"
          networkType: "Ethernet" #Ethernet / FibreChannel are the options
          networkUris:
            - "{{ NET_Deploy_Uri }}"
#
        - logicalPortConfigInfos:
          - desiredSpeed: "Auto"
            logicalLocation:
                  locationEntries:
                    - relativeValue: 6
                      type: "Bay"
                    - relativeValue: "{{ Port_Eth_FCoE_Q3:1 }}" #Ethernet + FCoE Capability
                      type: "Port"
                    - relativeValue: 1
                      type: "Enclosure"
          - desiredSpeed: "Auto"
            logicalLocation:
                  locationEntries:
                    - relativeValue: 6
                      type: "Bay"
                    - relativeValue: "{{ Port_Eth_FCoE_Q4:1 }}" #Ethernet + FCoE Capability
                      type: "Port"
                    - relativeValue: 1
                      type: "Enclosure"
          - desiredSpeed: "Auto"
            logicalLocation:
                  locationEntries:
                    - relativeValue: 3
                      type: "Bay"
                    - relativeValue: "{{ Port_Eth_FCoE_Q3:1 }}" #Ethernet + FCoE Capability
                      type: "Port"
                    - relativeValue: 1
                      type: "Enclosure"
          - desiredSpeed: "Auto"
            logicalLocation:
                  locationEntries:
                    - relativeValue: 3
                      type: "Bay"
                    - relativeValue: "{{ Port_Eth_FCoE_Q4:1 }}" #Ethernet + FCoE Capability
                      type: "Port"
                    - relativeValue: 1
                      type: "Enclosure"
          name: "LAN-UplinkSet"
          mode: "Auto"
          networkType: "Ethernet" #Ethernet / FibreChannel are the options
          networkUris:
            - "{{ NET_VLANDMZ_Uri }}"
            - "{{ NET_VLANMan_Uri }}"
            - "{{ NET_VLANCust_Uri }}"

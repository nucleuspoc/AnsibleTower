- name: Include all variable files
  include_vars:
    dir: 'vars' #change directory if needed
    extensions:
        - yml

- name: Gather facts about LIGs
  oneview_logical_interconnect_group_facts:
    config: "{{ config }}"
    name: "{{ LIG_name }}"

- set_fact: LIG_uri="{{ logical_interconnect_groups[0].uri }}"
#
# Create EG
#
- name: Ensure that Enclosure Group is present using the default configuration
  oneview_enclosure_group:
    config: "{{ playbook_dir }}/config.json"
    state: present
    data:
      name: "Enclosure Group 1"
      description: "Insert description on Enclosure Group"
      powerMode: "RedundantPowerFeed"
      enclosureType: "SY12000"
      stackingMode: "Enclosure"
      enclsoureCount: 1
      interconnectBayMappingCount: 2
      interconnectBayMappings:
        - interconnectBay: 1
        - interconnectBay: 2
        - interconnectBay: 3
          logicalInterconnectGroupUri: "{{ LIG_uri }}"
        - interconnectBay: 4
        - interconnectBay: 5
        - interconnectBay: 6
          logicalInterconnectGroupUri: "{{ LIG_uri }}"
#
# IP Section: Uri is the Management IP added in settings...NOT in Networks
#
      ipAddressingMode: "IpPool"
      ipRangeUris:
        - "{{ IP_Range_Uri }}"
#
# Gather information on Deployment Netork and Save URI
#
- name: Gather facts about Ethernet Networks by name
  oneview_ethernet_network_facts:
    config: "{{ config }}"
    name: "Deployment"

- set_fact: NET_Deploy_uri="{{ ethernet_networks[0].uri }}"
#
# OS Deploment Settings
#
      osDeploymentSettings:
        manageOSDeployment: true
        deploymentModeSettings:
          deploymentMode: "External"
          deploymentNetworkUri: "{{ NET_Deploy_uri }}" #Deployment Netork
